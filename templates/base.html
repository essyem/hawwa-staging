{% extends "base/base.html" %}
{% load i18n crispy_forms_tags %}

{# Provide header with navbar so apps that include `base.html` keep the same site header #}
{% block header %}
    {% include 'includes/header.html' %}
    {% include 'includes/mobile_sidebar.html' %}
    {# Desktop left sidebar remains an include within header block for layout reasons #}
    {% include 'includes/left_sidebar.html' %}
{% endblock %}

{# Keep extra JS block for theme toggle scripts used by header/footer #}
{% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const html = document.documentElement;
            const savedTheme = localStorage.getItem('theme') || 'light';
            html.setAttribute('data-theme', savedTheme);
            function updateIcon(theme) {
                if (theme === 'dark') {
                    themeIcon.className = 'fas fa-sun';
                    themeToggle.setAttribute('aria-pressed', 'true');
                } else {
                    themeIcon.className = 'fas fa-moon';
                    themeToggle.setAttribute('aria-pressed', 'false');
                }
            }
            updateIcon(savedTheme);
            themeToggle.addEventListener('click', function() {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                html.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateIcon(newTheme);
            });
        });
    </script>
{% endblock %}