{% extends 'admin_portal_base.html' %}

{% block title %}Services Management - Hawwa Admin{% endblock %}

{% block page_title %}Services Management{% endblock %}
{% block page_subtitle %}Manage wellness services, accommodations, and care providers{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'core:admin_service_list' %}">Services</a></li>
<li class="breadcrumb-item active">All Services</li>
{% endblock %}

{% block content %}
<!-- Action Bar -->
<div class="card border-0 shadow-sm mb-4">
    <div class="card-body py-3">
        <div class="row align-items-center">
            <div class="col-md-6">
                <div class="d-flex align-items-center">
                    <a href="{% url 'core:admin_service_create' %}" class="btn btn-success me-3">
                        <i class="fas fa-plus-circle me-2"></i>New Service
                    </a>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fas fa-download me-2"></i>Export
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="exportServices('pdf')">
                                <i class="fas fa-file-pdf me-2"></i>PDF Report
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="exportServices('excel')">
                                <i class="fas fa-file-excel me-2"></i>Excel Spreadsheet
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="exportServices('csv')">
                                <i class="fas fa-file-csv me-2"></i>CSV Data
                            </a></li>
                        </ul>
                    </div>
                    <button type="button" class="btn btn-outline-info ms-2" onclick="toggleBulkEdit()">
                        <i class="fas fa-edit me-2"></i>Bulk Edit
                    </button>
                </div>
            </div>
            <div class="col-md-6">
                <div class="input-group">
                    <input type="text" class="form-control" id="serviceSearch" placeholder="Search services by name, category, or provider...">
                    <button class="btn btn-outline-secondary" type="button" onclick="filterServices()">
                        <i class="fas fa-search"></i>
                    </button>
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="fas fa-filter"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><h6 class="dropdown-header">Filter by Category</h6></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="all">All Services</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="ACCOMMODATION">Accommodation</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="HOMECARE">Home Care</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="WELLNESS">Wellness</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="MENTAL_HEALTH">Mental Health</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="NUTRITION">Nutrition</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="active">Active Only</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="inactive">Inactive Only</a></li>
                        <li><a class="dropdown-item filter-option" href="#" data-filter="featured">Featured</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Services Stats Cards -->
<div class="row g-4 mb-4">
    <div class="col-lg-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-primary bg-gradient rounded-3 p-3">
                            <i class="fas fa-spa text-white fs-4"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <div class="text-muted small">Total Services</div>
                        <div class="fs-4 fw-bold text-dark">{{ total_services|default:"0" }}</div>
                        <div class="text-success small">
                            <i class="fas fa-arrow-up"></i> {{ new_this_month|default:"0" }} this month
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-success bg-gradient rounded-3 p-3">
                            <i class="fas fa-check-circle text-white fs-4"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <div class="text-muted small">Active Services</div>
                        <div class="fs-4 fw-bold text-dark">{{ active_services|default:"0" }}</div>
                        <div class="text-info small">
                            {{ active_percentage|default:"0" }}% of total
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-warning bg-gradient rounded-3 p-3">
                            <i class="fas fa-star text-white fs-4"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <div class="text-muted small">Avg Rating</div>
                        <div class="fs-4 fw-bold text-dark">{{ avg_rating|default:"0" }}</div>
                        <div class="text-warning small">
                            <i class="fas fa-star"></i> Based on {{ total_reviews|default:"0" }} reviews
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-info bg-gradient rounded-3 p-3">
                            <i class="fas fa-calendar-check text-white fs-4"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <div class="text-muted small">Monthly Bookings</div>
                        <div class="fs-4 fw-bold text-dark">{{ monthly_bookings|default:"0" }}</div>
                        <div class="text-success small">
                            <i class="fas fa-arrow-up"></i> {{ booking_growth|default:"0" }}% growth
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Services Table -->
<div class="card border-0 shadow-sm">
    <div class="card-header bg-transparent border-0 d-flex align-items-center justify-content-between">
        <div>
            <h5 class="card-title mb-0">
                <i class="fas fa-list me-2 text-primary"></i>
                Service Listings
            </h5>
            <small class="text-muted">
                Showing {{ services.count }} service{{ services.count|pluralize }}
                {% if is_paginated %}(Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}){% endif %}
            </small>
        </div>
        <div class="btn-group btn-group-sm" role="group">
            <input type="radio" class="btn-check" name="viewType" id="listView" autocomplete="off" checked>
            <label class="btn btn-outline-secondary" for="listView">
                <i class="fas fa-list"></i> List
            </label>
            <input type="radio" class="btn-check" name="viewType" id="cardView" autocomplete="off">
            <label class="btn btn-outline-secondary" for="cardView">
                <i class="fas fa-th-large"></i> Cards
            </label>
        </div>
    </div>
    
    <div class="card-body p-0">
        <!-- List View -->
        <div id="serviceListView" class="table-responsive">
            <table class="table table-hover mb-0" id="servicesTable">
                <thead class="table-light sticky-top">
                    <tr>
                        <th width="5%">
                            <input type="checkbox" id="selectAll" class="form-check-input">
                        </th>
                        <th width="8%">Image</th>
                        <th width="25%">
                            <a href="#" class="text-decoration-none text-dark sort-link" data-sort="name">
                                Service Name <i class="fas fa-sort ms-1"></i>
                            </a>
                        </th>
                        <th width="15%">
                            <a href="#" class="text-decoration-none text-dark sort-link" data-sort="category">
                                Category <i class="fas fa-sort ms-1"></i>
                            </a>
                        </th>
                        <th width="15%">Provider</th>
                        <th width="10%" class="text-end">
                            <a href="#" class="text-decoration-none text-dark sort-link" data-sort="price">
                                Price <i class="fas fa-sort ms-1"></i>
                            </a>
                        </th>
                        <th width="8%">Rating</th>
                        <th width="8%">Status</th>
                        <th width="12%" class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for service in services %}
                        <tr class="service-row" 
                            data-category="{{ service.category }}"
                            data-status="{% if service.is_active %}active{% else %}inactive{% endif %}"
                            data-featured="{% if service.is_featured %}featured{% else %}regular{% endif %}">
                            <td>
                                <input type="checkbox" class="form-check-input service-checkbox" 
                                       value="{{ service.pk }}">
                            </td>
                            <td>
                                {% if service.image %}
                                    <img src="{{ service.image.url }}" alt="{{ service.name }}" 
                                         class="rounded" style="width: 50px; height: 50px; object-fit: cover;">
                                {% else %}
                                    <div class="bg-light rounded d-flex align-items-center justify-content-center" 
                                         style="width: 50px; height: 50px;">
                                        <i class="fas fa-spa text-muted"></i>
                                    </div>
                                {% endif %}
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div>
                                        <strong>{{ service.name }}</strong>
                                        {% if service.is_featured %}
                                            <i class="fas fa-star text-warning ms-1" title="Featured Service"></i>
                                        {% endif %}
                                        {% if service.description %}
                                            <small class="text-muted d-block">{{ service.description|truncatechars:60 }}</small>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="badge bg-{% if service.category == 'ACCOMMODATION' %}info{% elif service.category == 'HOMECARE' %}success{% elif service.category == 'WELLNESS' %}primary{% elif service.category == 'MENTAL_HEALTH' %}warning{% else %}secondary{% endif %} bg-gradient">
                                    {{ service.get_category_display }}
                                </span>
                            </td>
                            <td>
                                {% if service.provider %}
                                    <div class="d-flex align-items-center">
                                        {% if service.provider.profile_picture %}
                                            <img src="{{ service.provider.profile_picture.url }}" 
                                                 class="rounded-circle me-2" width="24" height="24">
                                        {% endif %}
                                        <span class="text-primary">{{ service.provider.get_full_name }}</span>
                                    </div>
                                {% else %}
                                    <em class="text-muted">No provider assigned</em>
                                {% endif %}
                            </td>
                            <td class="text-end">
                                <span class="fw-bold text-success">
                                    {% if service.price %}
                                        QAR {{ service.price }}
                                        {% if service.price_unit %}
                                            <small class="text-muted">/{{ service.price_unit }}</small>
                                        {% endif %}
                                    {% else %}
                                        <em class="text-muted">Contact for pricing</em>
                                    {% endif %}
                                </span>
                            </td>
                            <td>
                                {% if service.average_rating %}
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-warning text-dark">
                                            <i class="fas fa-star"></i> {{ service.average_rating|floatformat:1 }}
                                        </span>
                                        <small class="text-muted ms-1">({{ service.review_count }})</small>
                                    </div>
                                {% else %}
                                    <span class="text-muted">No reviews</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if service.is_active %}
                                    <span class="badge bg-success">Active</span>
                                {% else %}
                                    <span class="badge bg-secondary">Inactive</span>
                                {% endif %}
                            </td>
                            <td class="text-center">
                                <div class="btn-group btn-group-sm" role="group">
                                    <a href="{% url 'core:admin_service_detail' service.pk %}" 
                                       class="btn btn-outline-info" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{% url 'core:admin_service_edit' service.pk %}" 
                                       class="btn btn-outline-primary" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button type="button" class="btn btn-outline-success" 
                                            title="Bookings" onclick="viewBookings({{ service.pk }})">
                                        <i class="fas fa-calendar"></i>
                                    </button>
                                    <button type="button" class="btn btn-outline-danger" 
                                            title="Delete" onclick="deleteService({{ service.pk }}, '{{ service.name|escapejs }}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="9" class="text-center py-5">
                                <div class="text-muted">
                                    <i class="fas fa-spa display-4 d-block mb-3"></i>
                                    <h5>No Services Found</h5>
                                    <p>Get started by adding your first wellness service.</p>
                                    <a href="{% url 'core:admin_service_create' %}" class="btn btn-success">
                                        <i class="fas fa-plus-circle me-2"></i>Add Service
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Card View -->
        <div id="serviceCardView" class="d-none p-3">
            <div class="row g-3">
                {% for service in services %}
                    <div class="col-xl-4 col-lg-6">
                        <div class="card h-100 service-card" 
                             data-category="{{ service.category }}"
                             data-status="{% if service.is_active %}active{% else %}inactive{% endif %}"
                             data-featured="{% if service.is_featured %}featured{% else %}regular{% endif %}">
                            {% if service.image %}
                                <img src="{{ service.image.url }}" class="card-img-top" 
                                     style="height: 200px; object-fit: cover;" alt="{{ service.name }}">
                            {% else %}
                                <div class="card-img-top bg-light d-flex align-items-center justify-content-center" 
                                     style="height: 200px;">
                                    <i class="fas fa-spa text-muted fa-3x"></i>
                                </div>
                            {% endif %}
                            
                            <div class="card-body">
                                <div class="d-flex align-items-start justify-content-between mb-2">
                                    <h6 class="card-title mb-1">
                                        {{ service.name }}
                                        {% if service.is_featured %}
                                            <i class="fas fa-star text-warning ms-1"></i>
                                        {% endif %}
                                    </h6>
                                    <span class="badge bg-{% if service.category == 'ACCOMMODATION' %}info{% elif service.category == 'HOMECARE' %}success{% elif service.category == 'WELLNESS' %}primary{% elif service.category == 'MENTAL_HEALTH' %}warning{% else %}secondary{% endif %}">
                                        {{ service.get_category_display }}
                                    </span>
                                </div>
                                
                                {% if service.description %}
                                    <p class="card-text text-muted small mb-3">{{ service.description|truncatechars:100 }}</p>
                                {% endif %}
                                
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <small class="text-muted">Price:</small>
                                        <div class="fw-bold text-success">
                                            {% if service.price %}
                                                QAR {{ service.price }}
                                            {% else %}
                                                Contact for pricing
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Rating:</small>
                                        <div>
                                            {% if service.average_rating %}
                                                <span class="badge bg-warning text-dark">
                                                    <i class="fas fa-star"></i> {{ service.average_rating|floatformat:1 }}
                                                </span>
                                            {% else %}
                                                <span class="text-muted">No reviews</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center justify-content-between">
                                    <div>
                                        {% if service.is_active %}
                                            <span class="badge bg-success">Active</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Inactive</span>
                                        {% endif %}
                                    </div>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{% url 'core:admin_service_detail' service.pk %}" class="btn btn-outline-info">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{% url 'core:admin_service_edit' service.pk %}" class="btn btn-outline-primary">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <button type="button" class="btn btn-outline-danger" 
                                                onclick="deleteService({{ service.pk }}, '{{ service.name|escapejs }}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% empty %}
                    <div class="col-12 text-center py-5">
                        <div class="text-muted">
                            <i class="fas fa-spa display-4 d-block mb-3"></i>
                            <h5>No Services Found</h5>
                            <p>Get started by adding your first wellness service.</p>
                            <a href="{% url 'core:admin_service_create' %}" class="btn btn-success">
                                <i class="fas fa-plus-circle me-2"></i>Add Service
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
        <div class="card-footer bg-transparent">
            <nav aria-label="Services pagination">
                <ul class="pagination pagination-sm justify-content-center mb-0">
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page=1">First</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                    {% endif %}
                    
                    {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% elif num > page_obj.number|add:-3 and num < page_obj.number|add:3 %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    {% endif %}
</div>

<!-- Bulk Action Modal -->
<div class="modal fade" id="bulkActionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Bulk Actions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Select an action for <span id="selectedCount">0</span> selected service(s):</p>
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-warning" onclick="bulkToggleStatus()">
                        <i class="fas fa-toggle-off me-2"></i>Toggle Active Status
                    </button>
                    <button type="button" class="btn btn-success" onclick="bulkToggleFeatured()">
                        <i class="fas fa-star me-2"></i>Toggle Featured
                    </button>
                    <button type="button" class="btn btn-info" onclick="bulkExport()">
                        <i class="fas fa-download me-2"></i>Export Selected
                    </button>
                    <button type="button" class="btn btn-danger" onclick="bulkDelete()">
                        <i class="fas fa-trash me-2"></i>Delete Selected
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // View toggle functionality
    $('input[name="viewType"]').change(function() {
        if ($(this).attr('id') === 'cardView') {
            $('#serviceListView').addClass('d-none');
            $('#serviceCardView').removeClass('d-none');
        } else {
            $('#serviceCardView').addClass('d-none');
            $('#serviceListView').removeClass('d-none');
        }
    });

    // Search functionality
    $('#serviceSearch').on('keyup', function() {
        filterServices();
    });

    // Filter functionality
    $('.filter-option').click(function(e) {
        e.preventDefault();
        const filter = $(this).data('filter');
        applyFilter(filter);
    });

    // Select all functionality
    $('#selectAll').change(function() {
        $('.service-checkbox').prop('checked', this.checked);
        updateBulkActions();
    });

    $('.service-checkbox').change(function() {
        updateBulkActions();
    });

    // Sorting functionality
    $('.sort-link').click(function(e) {
        e.preventDefault();
        const sortBy = $(this).data('sort');
        sortTable(sortBy);
    });
});

function filterServices() {
    const searchTerm = $('#serviceSearch').val().toLowerCase();
    const rows = $('.service-row, .service-card');
    
    rows.each(function() {
        const serviceName = $(this).find('strong, .card-title').first().text().toLowerCase();
        const description = $(this).find('.text-muted').text().toLowerCase();
        const provider = $(this).find('.text-primary').text().toLowerCase();
        
        const matches = serviceName.includes(searchTerm) || 
                       description.includes(searchTerm) || 
                       provider.includes(searchTerm);
        
        $(this).toggle(matches);
    });
}

function applyFilter(filter) {
    const rows = $('.service-row, .service-card');
    
    rows.each(function() {
        const category = $(this).data('category');
        const status = $(this).data('status');
        const featured = $(this).data('featured');
        
        let show = true;
        
        if (filter === 'all') {
            show = true;
        } else if (['ACCOMMODATION', 'HOMECARE', 'WELLNESS', 'MENTAL_HEALTH', 'NUTRITION'].includes(filter)) {
            show = category === filter;
        } else if (filter === 'active') {
            show = status === 'active';
        } else if (filter === 'inactive') {
            show = status === 'inactive';
        } else if (filter === 'featured') {
            show = featured === 'featured';
        }
        
        $(this).toggle(show);
    });
}

function updateBulkActions() {
    const checkedBoxes = $('.service-checkbox:checked');
    $('#selectedCount').text(checkedBoxes.length);
    
    if (checkedBoxes.length > 0) {
        if (!$('#bulkActionsBtn').length) {
            $('<button type="button" id="bulkActionsBtn" class="btn btn-outline-secondary ms-2" data-bs-toggle="modal" data-bs-target="#bulkActionModal">' +
              '<i class="fas fa-cog me-2"></i>Bulk Actions</button>')
              .insertAfter('.btn-group:first');
        }
    } else {
        $('#bulkActionsBtn').remove();
    }
}

function deleteService(serviceId, serviceName) {
    if (confirm(`Are you sure you want to delete service "${serviceName}"?\n\nThis action cannot be undone and may affect related bookings.`)) {
        // TODO: Implement delete via AJAX
        window.location.href = `/admin/services/${serviceId}/delete/`;
    }
}

function viewBookings(serviceId) {
    window.location.href = `/admin/bookings/?service=${serviceId}`;
}

function exportServices(format) {
    const params = new URLSearchParams();
    params.append('format', format);
    params.append('search', $('#serviceSearch').val());
    
    window.open(`/admin/services/export/?${params.toString()}`, '_blank');
}

function toggleBulkEdit() {
    $('.service-checkbox').toggle();
    $('#selectAll').toggle();
    updateBulkActions();
}

function sortTable(column) {
    // TODO: Implement client-side sorting or redirect with sort parameter
    console.log('Sorting by:', column);
}

function bulkToggleStatus() {
    const selectedIds = $('.service-checkbox:checked').map(function() {
        return this.value;
    }).get();
    
    if (selectedIds.length > 0) {
        // TODO: Implement bulk status toggle via AJAX
        console.log('Toggle status for services:', selectedIds);
        $('#bulkActionModal').modal('hide');
        showToast('Status updated for selected services', 'success');
    }
}

function bulkToggleFeatured() {
    const selectedIds = $('.service-checkbox:checked').map(function() {
        return this.value;
    }).get();
    
    if (selectedIds.length > 0) {
        // TODO: Implement bulk featured toggle via AJAX
        console.log('Toggle featured for services:', selectedIds);
        $('#bulkActionModal').modal('hide');
        showToast('Featured status updated for selected services', 'success');
    }
}

function bulkExport() {
    const selectedIds = $('.service-checkbox:checked').map(function() {
        return this.value;
    }).get();
    
    if (selectedIds.length > 0) {
        const params = new URLSearchParams();
        params.append('format', 'excel');
        params.append('services', selectedIds.join(','));
        
        window.open(`/admin/services/export/?${params.toString()}`, '_blank');
        $('#bulkActionModal').modal('hide');
    }
}

function bulkDelete() {
    const selectedIds = $('.service-checkbox:checked').map(function() {
        return this.value;
    }).get();
    
    if (selectedIds.length > 0 && confirm(`Are you sure you want to delete ${selectedIds.length} selected service(s)?\n\nThis action cannot be undone.`)) {
        // TODO: Implement bulk delete via AJAX
        console.log('Delete services:', selectedIds);
        $('#bulkActionModal').modal('hide');
        showToast('Selected services deleted successfully', 'success');
    }
}

function showToast(message, type) {
    // Use the global toast function from admin-portal.js
    if (window.hawwaAdmin && window.hawwaAdmin.showToast) {
        window.hawwaAdmin.showToast(message, type);
    }
}
</script>
{% endblock %}