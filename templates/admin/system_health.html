{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}{% trans 'System Health Dashboard' %} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block extrahead %}
    <style>
        .health-dashboard {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
        }
        
        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .health-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .health-status {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .status-healthy {
            background: #28a745;
        }
        
        .status-warning {
            background: #ffc107;
        }
        
        .status-error {
            background: #dc3545;
        }
        
        .health-metric {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .health-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .system-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #007cba;
        }
        
        .refresh-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            margin-bottom: 20px;
        }
        
        .refresh-button:hover {
            background: #0056b3;
        }
        
        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-top: 20px;
        }
    </style>
{% endblock %}

{% block content %}
<div class="health-dashboard">
    <h1>{% trans 'System Health Dashboard' %}</h1>
    <p>{% trans 'Real-time monitoring of platform components and performance' %}</p>
</div>

<button onclick="location.reload()" class="refresh-button">
    {% trans 'Refresh Status' %}
</button>

<div class="health-grid">
    <!-- Database Health -->
    <div class="health-card">
        <div class="health-status">
            <div class="status-indicator {% if system_stats.db_status == 'healthy' %}status-healthy{% else %}status-error{% endif %}"></div>
            <h3>{% trans 'Database' %}</h3>
        </div>
        <div class="health-metric">
            {% if system_stats.db_status == 'healthy' %}
                ✓ {% trans 'Online' %}
            {% else %}
                ✗ {% trans 'Error' %}
            {% endif %}
        </div>
        <div class="health-label">
            {% if system_stats.db_status != 'healthy' %}
                {{ system_stats.db_status }}
            {% else %}
                {% trans 'Connection healthy' %}
            {% endif %}
        </div>
    </div>
    
    <!-- Cache Health -->
    <div class="health-card">
        <div class="health-status">
            <div class="status-indicator {% if system_stats.cache_status == 'healthy' %}status-healthy{% else %}status-error{% endif %}"></div>
            <h3>{% trans 'Cache System' %}</h3>
        </div>
        <div class="health-metric">
            {% if system_stats.cache_status == 'healthy' %}
                ✓ {% trans 'Active' %}
            {% else %}
                ✗ {% trans 'Error' %}
            {% endif %}
        </div>
        <div class="health-label">
            {% if system_stats.cache_status != 'healthy' %}
                {{ system_stats.cache_status }}
            {% else %}
                {% trans 'Cache responsive' %}
            {% endif %}
        </div>
    </div>
    
    <!-- User Activity -->
    <div class="health-card">
        <div class="health-status">
            <div class="status-indicator status-healthy"></div>
            <h3>{% trans 'User Activity' %}</h3>
        </div>
        <div class="health-metric">{{ system_stats.last_login_24h }}</div>
        <div class="health-label">{% trans 'Logins in last 24h' %}</div>
    </div>
    
    <!-- Active Sessions -->
    <div class="health-card">
        <div class="health-status">
            <div class="status-indicator status-healthy"></div>
            <h3>{% trans 'System Load' %}</h3>
        </div>
        <div class="health-metric">{{ system_stats.active_sessions }}</div>
        <div class="health-label">{% trans 'Active sessions' %}</div>
    </div>
</div>

<!-- System Information -->
<div class="system-info">
    <h2>{% trans 'System Information' %}</h2>
    <div class="info-grid">
        <div class="info-item">
            <h4>{% trans 'Total Users' %}</h4>
            <p>{{ system_stats.total_users }}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'Admin Users' %}</h4>
            <p>{{ system_stats.admin_users }}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'Django Version' %}</h4>
            <p>{{ django_version|default:"Unknown" }}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'Python Version' %}</h4>
            <p>{{ python_version|default:"Unknown" }}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'Server Time' %}</h4>
            <p>{{ server_time|default:"Unknown" }}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'Platform Status' %}</h4>
            <p style="color: #28a745; font-weight: bold;">{% trans 'Operational' %}</p>
        </div>
    </div>
</div>

<!-- Health Checks -->
<div class="system-info">
    <h2>{% trans 'Health Checks' %}</h2>
    <div class="info-grid">
        <div class="info-item">
            <h4>{% trans 'Email System' %}</h4>
            <p style="color: #28a745;">✓ {% trans 'Configured' %}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'Static Files' %}</h4>
            <p style="color: #28a745;">✓ {% trans 'Available' %}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'Media Files' %}</h4>
            <p style="color: #28a745;">✓ {% trans 'Available' %}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'Admin Panel' %}</h4>
            <p style="color: #28a745;">✓ {% trans 'Accessible' %}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'User Registration' %}</h4>
            <p style="color: #28a745;">✓ {% trans 'Enabled' %}</p>
        </div>
        
        <div class="info-item">
            <h4>{% trans 'API Endpoints' %}</h4>
            <p style="color: #28a745;">✓ {% trans 'Responding' %}</p>
        </div>
    </div>
</div>

<div class="last-updated">
    {% trans 'Last updated:' %} <span id="lastUpdated"></span>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set last updated time
    document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
    
    // Auto-refresh every 30 seconds
    setInterval(function() {
        location.reload();
    }, 30000);
});
</script>
{% endblock %}