{% extends 'admin_portal_base.html' %}

{% block title %}Analytics Dashboard - Hawwa Admin{% endblock %}

{% block page_title %}Analytics Dashboard{% endblock %}
{% block page_subtitle %}Comprehensive business insights and performance metrics{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active">Analytics</li>
{% endblock %}

{% block content %}
<!-- Key Performance Indicators -->
<div class="row g-4 mb-4">
    <div class="col-xl-2 col-md-4 col-6">
        <div class="card border-0 shadow-sm bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div class="card-body text-white text-center">
                <i class="fas fa-chart-line fa-2x mb-2 opacity-75"></i>
                <h4 class="mb-0">QAR {{ analytics.total_revenue|default:"0"|floatformat:0 }}</h4>
                <small class="opacity-75">Total Revenue</small>
                <div class="small mt-1">
                    <i class="fas fa-arrow-up"></i> +15.3%
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-2 col-md-4 col-6">
        <div class="card border-0 shadow-sm bg-gradient" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <div class="card-body text-white text-center">
                <i class="fas fa-calendar-check fa-2x mb-2 opacity-75"></i>
                <h4 class="mb-0">{{ analytics.total_bookings|default:0 }}</h4>
                <small class="opacity-75">Total Bookings</small>
                <div class="small mt-1">
                    <i class="fas fa-arrow-up"></i> +8.7%
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-2 col-md-4 col-6">
        <div class="card border-0 shadow-sm bg-gradient" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <div class="card-body text-white text-center">
                <i class="fas fa-users fa-2x mb-2 opacity-75"></i>
                <h4 class="mb-0">{{ analytics.total_clients|default:0 }}</h4>
                <small class="opacity-75">Active Clients</small>
                <div class="small mt-1">
                    <i class="fas fa-arrow-up"></i> +12.1%
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-2 col-md-4 col-6">
        <div class="card border-0 shadow-sm bg-gradient" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
            <div class="card-body text-white text-center">
                <i class="fas fa-user-tie fa-2x mb-2 opacity-75"></i>
                <h4 class="mb-0">{{ analytics.total_vendors|default:0 }}</h4>
                <small class="opacity-75">Active Vendors</small>
                <div class="small mt-1">
                    <i class="fas fa-arrow-up"></i> +5.2%
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-2 col-md-4 col-6">
        <div class="card border-0 shadow-sm bg-gradient" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
            <div class="card-body text-center">
                <i class="fas fa-star fa-2x mb-2 text-warning"></i>
                <h4 class="mb-0">{{ analytics.avg_rating|default:"4.5" }}</h4>
                <small class="text-muted">Avg Rating</small>
                <div class="small mt-1 text-success">
                    <i class="fas fa-arrow-up"></i> +0.2
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-2 col-md-4 col-6">
        <div class="card border-0 shadow-sm bg-gradient" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
            <div class="card-body text-center">
                <i class="fas fa-percentage fa-2x mb-2 text-info"></i>
                <h4 class="mb-0">{{ analytics.conversion_rate|default:"3.2" }}%</h4>
                <small class="text-muted">Conversion Rate</small>
                <div class="small mt-1 text-success">
                    <i class="fas fa-arrow-up"></i> +0.8%
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Analytics Controls -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex flex-wrap align-items-center justify-content-between">
                    <div class="d-flex flex-wrap gap-2 mb-2 mb-md-0">
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="timePeriod" id="today" checked>
                            <label class="btn btn-outline-primary" for="today">Today</label>
                            
                            <input type="radio" class="btn-check" name="timePeriod" id="week">
                            <label class="btn btn-outline-primary" for="week">7 Days</label>
                            
                            <input type="radio" class="btn-check" name="timePeriod" id="month">
                            <label class="btn btn-outline-primary" for="month">30 Days</label>
                            
                            <input type="radio" class="btn-check" name="timePeriod" id="quarter">
                            <label class="btn btn-outline-primary" for="quarter">90 Days</label>
                        </div>
                        
                        <button class="btn btn-outline-success" onclick="refreshData()">
                            <i class="fas fa-sync-alt me-2"></i>Refresh Data
                        </button>
                        
                        <button class="btn btn-outline-info" onclick="exportAnalytics()">
                            <i class="fas fa-download me-2"></i>Export Report
                        </button>
                    </div>

                    <div class="d-flex flex-wrap gap-2">
                        <div class="input-group" style="width: 200px;">
                            <input type="date" class="form-control" id="startDate">
                        </div>
                        <div class="input-group" style="width: 200px;">
                            <input type="date" class="form-control" id="endDate">
                        </div>
                        <button class="btn btn-primary" onclick="applyDateFilter()">Apply</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Analytics Tabs -->
<div class="card border-0 shadow-sm">
    <div class="card-header bg-transparent border-0">
        <ul class="nav nav-tabs card-header-tabs" id="analyticsTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
                    <i class="fas fa-chart-pie me-2"></i>Overview
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="revenue-tab" data-bs-toggle="tab" data-bs-target="#revenue" type="button" role="tab">
                    <i class="fas fa-dollar-sign me-2"></i>Revenue
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="customers-tab" data-bs-toggle="tab" data-bs-target="#customers" type="button" role="tab">
                    <i class="fas fa-users me-2"></i>Customers
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="services-tab" data-bs-toggle="tab" data-bs-target="#services" type="button" role="tab">
                    <i class="fas fa-spa me-2"></i>Services
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab">
                    <i class="fas fa-tachometer-alt me-2"></i>Performance
                </button>
            </li>
        </ul>
    </div>
    
    <div class="card-body">
        <div class="tab-content" id="analyticsTabsContent">
            <!-- Overview Tab -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                <div class="row g-4">
                    <!-- Revenue Overview Chart -->
                    <div class="col-lg-8">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="card-title mb-0">Revenue Trend</h6>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <input type="radio" class="btn-check" name="revenueView" id="daily" checked>
                                        <label class="btn btn-outline-secondary" for="daily">Daily</label>
                                        
                                        <input type="radio" class="btn-check" name="revenueView" id="weekly">
                                        <label class="btn btn-outline-secondary" for="weekly">Weekly</label>
                                        
                                        <input type="radio" class="btn-check" name="revenueView" id="monthly">
                                        <label class="btn btn-outline-secondary" for="monthly">Monthly</label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="revenueOverviewChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Service Categories -->
                    <div class="col-lg-4">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Service Categories</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="serviceCategoriesChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Key Metrics -->
                    <div class="col-lg-6">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Business Metrics</h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-6">
                                        <div class="text-center p-3 border rounded">
                                            <div class="h4 text-primary mb-0">QAR {{ analytics.avg_order_value|default:"150"|floatformat:0 }}</div>
                                            <small class="text-muted">Avg Order Value</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="text-center p-3 border rounded">
                                            <div class="h4 text-success mb-0">{{ analytics.repeat_customer_rate|default:"35" }}%</div>
                                            <small class="text-muted">Repeat Customers</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="text-center p-3 border rounded">
                                            <div class="h4 text-info mb-0">{{ analytics.booking_completion_rate|default:"92" }}%</div>
                                            <small class="text-muted">Completion Rate</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="text-center p-3 border rounded">
                                            <div class="h4 text-warning mb-0">{{ analytics.cancellation_rate|default:"8" }}%</div>
                                            <small class="text-muted">Cancellation Rate</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Performers -->
                    <div class="col-lg-6">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Top Performing Services</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="small">Therapeutic Massage</span>
                                        <strong class="small">QAR 15,420</strong>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-primary" style="width: 90%"></div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="small">Beauty Treatments</span>
                                        <strong class="small">QAR 12,890</strong>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-success" style="width: 75%"></div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="small">Fitness Coaching</span>
                                        <strong class="small">QAR 9,650</strong>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-info" style="width: 60%"></div>
                                    </div>
                                </div>
                                
                                <div class="mb-0">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="small">Wellness Consultation</span>
                                        <strong class="small">QAR 7,230</strong>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar bg-warning" style="width: 45%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Revenue Tab -->
            <div class="tab-pane fade" id="revenue" role="tabpanel">
                <div class="row g-4">
                    <!-- Revenue Chart -->
                    <div class="col-12">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="card-title mb-0">Revenue Analysis</h6>
                                    <div class="d-flex gap-2">
                                        <select class="form-select form-select-sm" id="revenueMetric">
                                            <option value="gross">Gross Revenue</option>
                                            <option value="net">Net Revenue</option>
                                            <option value="profit">Profit Margin</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="revenueChart" height="400"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue Breakdown -->
                    <div class="col-md-6">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Revenue by Payment Method</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="paymentMethodChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Revenue by Service Type</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="serviceRevenueChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Revenue Statistics -->
                    <div class="col-12">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Revenue Statistics</h6>
                            </div>
                            <div class="card-body">
                                <div class="row g-4">
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h3 text-primary">QAR {{ analytics.monthly_recurring_revenue|default:"8,450"|floatformat:0 }}</div>
                                            <div class="text-muted">Monthly Recurring Revenue</div>
                                            <small class="text-success"><i class="fas fa-arrow-up"></i> +12.3%</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h3 text-success">QAR {{ analytics.average_transaction|default:"185"|floatformat:0 }}</div>
                                            <div class="text-muted">Average Transaction</div>
                                            <small class="text-success"><i class="fas fa-arrow-up"></i> +5.7%</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h3 text-info">{{ analytics.revenue_growth_rate|default:"15.8" }}%</div>
                                            <div class="text-muted">Monthly Growth Rate</div>
                                            <small class="text-success"><i class="fas fa-arrow-up"></i> +2.1%</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="text-center">
                                            <div class="h3 text-warning">{{ analytics.profit_margin|default:"28.5" }}%</div>
                                            <div class="text-muted">Profit Margin</div>
                                            <small class="text-success"><i class="fas fa-arrow-up"></i> +1.2%</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customers Tab -->
            <div class="tab-pane fade" id="customers" role="tabpanel">
                <div class="row g-4">
                    <!-- Customer Acquisition -->
                    <div class="col-lg-8">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Customer Acquisition & Retention</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="customerAcquisitionChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Segments -->
                    <div class="col-lg-4">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Customer Segments</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="customerSegmentsChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Metrics -->
                    <div class="col-md-4">
                        <div class="card border-0 bg-gradient text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-center">
                                <i class="fas fa-user-plus fa-2x mb-3 opacity-75"></i>
                                <h3 class="mb-0">{{ analytics.new_customers_month|default:124 }}</h3>
                                <div class="small opacity-75">New Customers This Month</div>
                                <div class="mt-2">
                                    <small><i class="fas fa-arrow-up"></i> +18.5% from last month</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card border-0 bg-gradient text-white" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-center">
                                <i class="fas fa-heart fa-2x mb-3 opacity-75"></i>
                                <h3 class="mb-0">{{ analytics.customer_lifetime_value|default:"850" }}</h3>
                                <div class="small opacity-75">Customer Lifetime Value (QAR)</div>
                                <div class="mt-2">
                                    <small><i class="fas fa-arrow-up"></i> +8.2% from last month</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="card border-0 bg-gradient text-white" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <div class="card-body text-center">
                                <i class="fas fa-redo fa-2x mb-3 opacity-75"></i>
                                <h3 class="mb-0">{{ analytics.churn_rate|default:"5.2" }}%</h3>
                                <div class="small opacity-75">Monthly Churn Rate</div>
                                <div class="mt-2">
                                    <small><i class="fas fa-arrow-down text-success"></i> -1.3% from last month</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Customers -->
                    <div class="col-12">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Top Customers by Revenue</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0">
                                        <thead>
                                            <tr>
                                                <th>Customer</th>
                                                <th>Total Bookings</th>
                                                <th>Total Spent</th>
                                                <th>Last Visit</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-circle bg-primary text-white me-2" style="width: 32px; height: 32px; line-height: 32px;">
                                                            S
                                                        </div>
                                                        <div>
                                                            <div class="fw-bold">Sarah Johnson</div>
                                                            <small class="text-muted">sarah@email.com</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>15</td>
                                                <td class="fw-bold text-success">QAR 2,850</td>
                                                <td>Dec 14, 2024</td>
                                                <td><span class="badge bg-success">VIP</span></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-circle bg-info text-white me-2" style="width: 32px; height: 32px; line-height: 32px;">
                                                            M
                                                        </div>
                                                        <div>
                                                            <div class="fw-bold">Mohammed Al-Rashid</div>
                                                            <small class="text-muted">mohammed@email.com</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>12</td>
                                                <td class="fw-bold text-success">QAR 2,340</td>
                                                <td>Dec 13, 2024</td>
                                                <td><span class="badge bg-primary">Premium</span></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <div class="avatar-circle bg-success text-white me-2" style="width: 32px; height: 32px; line-height: 32px;">
                                                            A
                                                        </div>
                                                        <div>
                                                            <div class="fw-bold">Amina Hassan</div>
                                                            <small class="text-muted">amina@email.com</small>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>9</td>
                                                <td class="fw-bold text-success">QAR 1,890</td>
                                                <td>Dec 12, 2024</td>
                                                <td><span class="badge bg-warning">Regular</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Tab -->
            <div class="tab-pane fade" id="services" role="tabpanel">
                <div class="row g-4">
                    <!-- Service Performance -->
                    <div class="col-lg-8">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Service Performance Comparison</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="servicePerformanceChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Service Ratings -->
                    <div class="col-lg-4">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Average Ratings</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="small">Therapeutic Massage</span>
                                        <div class="d-flex align-items-center">
                                            <span class="me-2">4.9</span>
                                            <div class="text-warning">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="small">Beauty Treatments</span>
                                        <div class="d-flex align-items-center">
                                            <span class="me-2">4.7</span>
                                            <div class="text-warning">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="far fa-star"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="small">Fitness Coaching</span>
                                        <div class="d-flex align-items-center">
                                            <span class="me-2">4.6</span>
                                            <div class="text-warning">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="far fa-star"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-0">
                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                        <span class="small">Wellness Consultation</span>
                                        <div class="d-flex align-items-center">
                                            <span class="me-2">4.4</span>
                                            <div class="text-warning">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="far fa-star"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Service Analytics Table -->
                    <div class="col-12">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Service Analytics</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover align-middle mb-0">
                                        <thead>
                                            <tr>
                                                <th>Service</th>
                                                <th>Bookings</th>
                                                <th>Revenue</th>
                                                <th>Avg Rating</th>
                                                <th>Completion Rate</th>
                                                <th>Trend</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-spa text-primary me-2"></i>
                                                        Therapeutic Massage
                                                    </div>
                                                </td>
                                                <td><strong>245</strong></td>
                                                <td class="text-success"><strong>QAR 15,420</strong></td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <span class="me-1">4.9</span>
                                                        <i class="fas fa-star text-warning"></i>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <span class="me-2">96%</span>
                                                        <div class="progress flex-grow-1" style="height: 6px;">
                                                            <div class="progress-bar bg-success" style="width: 96%"></div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span class="text-success">
                                                        <i class="fas fa-arrow-up"></i> +15%
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-cut text-info me-2"></i>
                                                        Beauty Treatments
                                                    </div>
                                                </td>
                                                <td><strong>189</strong></td>
                                                <td class="text-success"><strong>QAR 12,890</strong></td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <span class="me-1">4.7</span>
                                                        <i class="fas fa-star text-warning"></i>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <span class="me-2">94%</span>
                                                        <div class="progress flex-grow-1" style="height: 6px;">
                                                            <div class="progress-bar bg-success" style="width: 94%"></div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span class="text-success">
                                                        <i class="fas fa-arrow-up"></i> +8%
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-dumbbell text-success me-2"></i>
                                                        Fitness Coaching
                                                    </div>
                                                </td>
                                                <td><strong>156</strong></td>
                                                <td class="text-success"><strong>QAR 9,650</strong></td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <span class="me-1">4.6</span>
                                                        <i class="fas fa-star text-warning"></i>
                                                    </div>
                                                </td>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <span class="me-2">89%</span>
                                                        <div class="progress flex-grow-1" style="height: 6px;">
                                                            <div class="progress-bar bg-warning" style="width: 89%"></div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>
                                                    <span class="text-success">
                                                        <i class="fas fa-arrow-up"></i> +5%
                                                    </span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Tab -->
            <div class="tab-pane fade" id="performance" role="tabpanel">
                <div class="row g-4">
                    <!-- Performance Metrics -->
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                        <i class="fas fa-clock fa-lg"></i>
                                    </div>
                                </div>
                                <h4 class="mb-1">{{ analytics.avg_response_time|default:"2.3" }}h</h4>
                                <p class="text-muted mb-0">Avg Response Time</p>
                                <small class="text-success"><i class="fas fa-arrow-down"></i> -15min</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                        <i class="fas fa-check-circle fa-lg"></i>
                                    </div>
                                </div>
                                <h4 class="mb-1">{{ analytics.first_time_resolution|default:"87" }}%</h4>
                                <p class="text-muted mb-0">First Time Resolution</p>
                                <small class="text-success"><i class="fas fa-arrow-up"></i> +3%</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                        <i class="fas fa-users fa-lg"></i>
                                    </div>
                                </div>
                                <h4 class="mb-1">{{ analytics.vendor_utilization|default:"78" }}%</h4>
                                <p class="text-muted mb-0">Vendor Utilization</p>
                                <small class="text-success"><i class="fas fa-arrow-up"></i> +5%</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm text-center">
                            <div class="card-body">
                                <div class="mb-3">
                                    <div class="bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                        <i class="fas fa-tachometer-alt fa-lg"></i>
                                    </div>
                                </div>
                                <h4 class="mb-1">{{ analytics.system_uptime|default:"99.8" }}%</h4>
                                <p class="text-muted mb-0">System Uptime</p>
                                <small class="text-success"><i class="fas fa-arrow-up"></i> +0.1%</small>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Chart -->
                    <div class="col-12">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">System Performance Over Time</h6>
                            </div>
                            <div class="card-body">
                                <canvas id="performanceChart" height="300"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Alerts -->
                    <div class="col-12">
                        <div class="card border-0 bg-light">
                            <div class="card-header bg-transparent border-0">
                                <h6 class="card-title mb-0">Performance Alerts</h6>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-success d-flex align-items-center">
                                    <i class="fas fa-check-circle me-3"></i>
                                    <div>
                                        <strong>System Performance</strong>
                                        <div class="small">All systems operating normally. No performance issues detected.</div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-warning d-flex align-items-center">
                                    <i class="fas fa-exclamation-triangle me-3"></i>
                                    <div>
                                        <strong>Peak Hours Load</strong>
                                        <div class="small">Higher than usual traffic detected during 2-4 PM. Consider scaling resources.</div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info d-flex align-items-center">
                                    <i class="fas fa-info-circle me-3"></i>
                                    <div>
                                        <strong>Scheduled Maintenance</strong>
                                        <div class="small">System maintenance scheduled for tonight 12:00-2:00 AM GMT+3.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
$(document).ready(function() {
    // Initialize all charts
    initRevenueOverviewChart();
    initServiceCategoriesChart();
    initRevenueChart();
    initPaymentMethodChart();
    initServiceRevenueChart();
    initCustomerAcquisitionChart();
    initCustomerSegmentsChart();
    initServicePerformanceChart();
    initPerformanceChart();
    
    // Initialize filters
    initAnalyticsFilters();
    
    // Auto-refresh data every 5 minutes
    setInterval(refreshData, 300000);
});

function initRevenueOverviewChart() {
    const ctx = document.getElementById('revenueOverviewChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Revenue',
                data: [2400, 3200, 2800, 3600, 4200, 3800, 4500],
                borderColor: '#6f42c1',
                backgroundColor: 'rgba(111, 66, 193, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return 'QAR ' + value;
                        }
                    }
                }
            }
        }
    });
}

function initServiceCategoriesChart() {
    const ctx = document.getElementById('serviceCategoriesChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Massage', 'Beauty', 'Fitness', 'Consultation'],
            datasets: [{
                data: [35, 25, 20, 20],
                backgroundColor: [
                    '#6f42c1',
                    '#28a745',
                    '#17a2b8',
                    '#ffc107'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

function initRevenueChart() {
    const ctx = document.getElementById('revenueChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'Gross Revenue',
                data: [15000, 18000, 22000, 25000, 21000, 28000, 32000, 29000, 35000, 38000, 42000, 45000],
                backgroundColor: '#6f42c1'
            }, {
                label: 'Net Revenue',
                data: [12000, 15000, 18000, 20000, 17000, 23000, 26000, 24000, 29000, 31000, 35000, 37000],
                backgroundColor: '#28a745'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return 'QAR ' + value.toLocaleString();
                        }
                    }
                }
            }
        }
    });
}

function initPaymentMethodChart() {
    const ctx = document.getElementById('paymentMethodChart').getContext('2d');
    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Credit Card', 'Bank Transfer', 'Digital Wallet', 'Cash'],
            datasets: [{
                data: [45, 25, 20, 10],
                backgroundColor: [
                    '#6f42c1',
                    '#28a745',
                    '#17a2b8',
                    '#ffc107'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

function initServiceRevenueChart() {
    const ctx = document.getElementById('serviceRevenueChart').getContext('2d');
    new Chart(ctx, {
        type: 'polarArea',
        data: {
            labels: ['Massage', 'Beauty', 'Fitness', 'Wellness'],
            datasets: [{
                data: [15420, 12890, 9650, 7230],
                backgroundColor: [
                    '#6f42c1',
                    '#28a745',
                    '#17a2b8',
                    '#ffc107'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
}

function initCustomerAcquisitionChart() {
    const ctx = document.getElementById('customerAcquisitionChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            datasets: [{
                label: 'New Customers',
                data: [28, 35, 42, 31],
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                fill: true
            }, {
                label: 'Returning Customers',
                data: [145, 158, 162, 171],
                borderColor: '#6f42c1',
                backgroundColor: 'rgba(111, 66, 193, 0.1)',
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

function initCustomerSegmentsChart() {
    const ctx = document.getElementById('customerSegmentsChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['VIP', 'Premium', 'Regular', 'New'],
            datasets: [{
                data: [15, 25, 45, 15],
                backgroundColor: [
                    '#dc3545',
                    '#6f42c1',
                    '#28a745',
                    '#ffc107'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

function initServicePerformanceChart() {
    const ctx = document.getElementById('servicePerformanceChart').getContext('2d');
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['Bookings', 'Revenue', 'Rating', 'Completion', 'Growth'],
            datasets: [{
                label: 'Massage',
                data: [90, 95, 98, 96, 85],
                borderColor: '#6f42c1',
                backgroundColor: 'rgba(111, 66, 193, 0.2)',
            }, {
                label: 'Beauty',
                data: [75, 80, 94, 94, 68],
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.2)',
            }, {
                label: 'Fitness',
                data: [65, 70, 92, 89, 55],
                borderColor: '#17a2b8',
                backgroundColor: 'rgba(23, 162, 184, 0.2)',
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100
                }
            }
        }
    });
}

function initPerformanceChart() {
    const ctx = document.getElementById('performanceChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: 24}, (_, i) => i + ':00'),
            datasets: [{
                label: 'Response Time (minutes)',
                data: [2.1, 1.8, 1.5, 1.3, 1.2, 1.4, 1.8, 2.3, 2.8, 3.1, 2.9, 2.7, 2.4, 2.6, 2.8, 3.2, 2.9, 2.5, 2.2, 1.9, 1.7, 1.6, 1.8, 2.0],
                borderColor: '#dc3545',
                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                yAxisID: 'y'
            }, {
                label: 'System Load (%)',
                data: [45, 38, 32, 28, 25, 30, 42, 58, 72, 78, 75, 70, 68, 72, 76, 82, 78, 65, 58, 52, 48, 44, 46, 48],
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                yAxisID: 'y1'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    grid: {
                        drawOnChartArea: false,
                    },
                },
            }
        }
    });
}

function initAnalyticsFilters() {
    // Time period change handlers
    $('input[name="timePeriod"]').change(function() {
        const period = $(this).attr('id');
        updateAnalytics(period);
    });
    
    // Auto-set today's date
    const today = new Date().toISOString().split('T')[0];
    $('#endDate').val(today);
    
    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);
    $('#startDate').val(weekAgo.toISOString().split('T')[0]);
}

function updateAnalytics(period) {
    console.log('Updating analytics for period:', period);
    // TODO: Implement period-based data loading
    
    // Show loading state
    $('.card-body canvas').addClass('opacity-50');
    
    // Simulate API call
    setTimeout(() => {
        $('.card-body canvas').removeClass('opacity-50');
        // Update charts with new data
    }, 1000);
}

function refreshData() {
    console.log('Refreshing analytics data...');
    // TODO: Implement data refresh functionality
    
    // Show refresh indicator
    $('button[onclick="refreshData()"] i').addClass('fa-spin');
    
    setTimeout(() => {
        $('button[onclick="refreshData()"] i').removeClass('fa-spin');
    }, 2000);
}

function applyDateFilter() {
    const startDate = $('#startDate').val();
    const endDate = $('#endDate').val();
    
    if (!startDate || !endDate) {
        alert('Please select both start and end dates');
        return;
    }
    
    console.log('Applying date filter:', { startDate, endDate });
    updateAnalytics('custom');
}

function exportAnalytics() {
    console.log('Exporting analytics report...');
    // TODO: Implement analytics export functionality
    window.location.href = '/admin/analytics/export/';
}
</script>
{% endblock %}